@model Ignia.Topics.Editor.Models.EditorViewModel

@{
  ViewBag.Title = "Home Page";
}

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "EditorForm" })) {

  @Html.Partial("_Toolbar")

  <div id="FormArea" class="row form area">
    <div class="col-md-9">
      @{int index = 0;}
      <div id="DisplayGroupTabsContent" class="tab-content">
        @foreach (string category in Model.ContentTypeDescriptor.AttributeDescriptors.Select(a => a.DisplayGroup).Distinct()) {

          var supportedAttributes = Model.ContentTypeDescriptor.AttributeDescriptors.Where(a => a.DisplayGroup.Equals(category));
          var displayGroup = category.Replace(" ", "");

          <div id="Group_@displayGroup" class="tab-pane fade@(index == 0 ? " show active" : "")" role="tabpanel" aria-labelledby="Tab_@displayGroup">
            <section id="@category.Replace(" ", "-")">

              @for (int i = 0; i < supportedAttributes.Count(); i++) {

                var attribute = supportedAttributes.ElementAt(i);
                var attributeViewModel = new AttributeViewModel(attribute, Model.Topic, Model.TopicRepository, ViewData);
                var type = attribute.Type.Replace(".ascx", "");

                if (attribute.Attributes.GetValue("IsHidden", "0").Equals("1")) {
                  continue;
                }

                @Html.EditorFor(m => attributeViewModel, type, displayGroup + "Attributes[" + i + "]")

              }

            </section>
          </div>

          index++;
        }
      </div>

    </div>
    <div class="col-md-3 callouts">
      <div class="callout topic-info">

        <h3 class="h5">Topic Information</h3>
        <dl>
          <dt><i class="fa fa-cogs"></i> Content Type</dt>
          <dd><a href="/Configuration/ContentTypes/@Model.Topic.ContentType">@Model.Topic.ContentType</a></dd>
          <dt><i class="fa fa-database"></i> Topic ID</dt>
          <dd><a href="/Topic/@Model.Topic.Id/">@Model.Topic.Id</a></dd>
          <dt><i class="fa fa-eye"></i> Current</dt>
          <dd><a href="@Model.Topic.WebPath">View Page</a></dd>
        </dl>

      </div>
    </div>
  </div>

}

@section scripts {
  <script>

    $(function() {

      /**
       * Wire up Attribute description tooltips
       */
      $('[data-toggle="tooltip"]').tooltip();

      /**
       * Sends AJAX request to Save/Edit Action
       */
      $('#SavePageButton').click(function() {

        $.ajax({
          url                   : '@Url.Action("Edit","Editor")',
          type                  : 'POST',
          data                  : @Model.Topic,
          success: function (result) {
            if (result == true) {
            }
            else {
            }
          }
        });

      });

      /**
       * Sends AJAX request to Delete Action
       */
      $('#DeletePageButton').click(function () {

        $.ajax({
          url                   : '@Url.Action("Delete","Editor")',
          type                  : 'POST',
          success: function (result) {
            if (result == true) {
            }
            else {
            }
          }
        });

      });

    });

    /**
     * Force the user to confirm they wish to delete a Topic before performing the deletion
     */
    function confirmDelete() {
      return confirm('Are you sure you want to delete the "@Model.Topic.Title.Replace("'", "&rsquo;")" topic? The topic and all descendants will be permanently deleted.');
    }

  </script>
}
