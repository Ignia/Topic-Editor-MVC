@model AttributeViewModel<RelationshipAttributeTopicViewModel>

@{
  Layout = "~/Areas/Editor/Views/Editor/Components/_Layout.cshtml";

  var descriptor                = Model.AttributeDescriptor;
  var rootTopicKey              = descriptor.RootTopic?.UniqueKey.Replace(":", "/")?? descriptor.RootTopicKey?.Replace(":", "/")?? "Root";
  var containerName             = ViewData.TemplateInfo.GetFullHtmlFieldName("TreeView");

}

<input asp-for="Value" type="hidden" />
<div id="@containerName"></div>

<script type="text/javascript">
  Ext.onReady(function(){
    var Tree            = Ext.tree;
    var Storage         = Ext.get("@Html.IdFor(m => m.Value)");
    var relationships   = Storage.dom.value.split(",");

    tree = new Tree.TreePanel({
      id                : 'relatedTree',
      useArrows         : true,
      autoScroll        : true,
      animate           : true,
      enableDD          : false,
      containerScroll   : true,
      border            : false,
      baseCls           : 'RelationshipsTreeView',
      dataUrl           : '/OnTopic/Json/@rootTopicKey?ShowRoot=@descriptor.ShowRoot&ShowAll=true&RelatedNamespace=@descriptor.Key&RelatedTopicID=@Model.CurrentTopic.Id&AttributeName=@descriptor.AttributeKey&AttributeValue=@descriptor.AttributeValue',
      root              : new Ext.tree.AsyncTreeNode({
        checked         : true,
        text            : 'Web',
        draggable       : false,
        id              : 'related',
        leaf            : false
      }),
      rootVisible       : false,
      listeners         : {
        click           : function(node) {
          node.checked  = true;
          node.select();
          return true;
        },
        checkchange     : function(node, checked) {
          if (checked) {
            relationships.push(node.attributes.id.toString());
          }
          else {
            relationships.remove(node.attributes.id.toString());
          }
          Storage.dom.value = relationships.concat(",");
          @(descriptor.CheckAscendants is true? "" : "return true")
          if (checked && node.parentNode) node.parentNode.getUI().toggleCheck(true);
        }
      }
    });
    tree.render('@containerName');

  });
</script>